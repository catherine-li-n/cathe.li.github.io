<!DOCTYPE html><html lang="en"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=0"><meta name="description" content="Vuex的简单使用 [ catherine's blog ] "><meta name="theme-color" content="#ebc65a"><title>Vuex的简单使用 [ catherine's blog ] </title><link rel="shortcut icon" href="/favicon.ico"><link rel="stylesheet" href="/css/index.css"><script src="https://cdn.bootcss.com/highlight.js/9.6.0/highlight.min.js" defer></script><script src="/js/paper.js" defer></script><script src="https://www.googletagmanager.com/gtag/js?id=xx-xxxxxxx-xx" async></script><script>window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'xx-xxxxxxx-xx');</script><link rel="stylesheet" href="/css/tocbot.css"><script src="/js/tocbot.js" defer></script><script>window.addEventListener('DOMContentLoaded', () => {
  tocbot.init({
    // Where to render the table of contents.
    tocSelector: '.toc__content',
    // Where to grab the headings to build the table of contents.
    contentSelector: '.article__content',
    // Which headings to grab inside of the contentSelector element.
    headingSelector: 'h1, h2, h3, h4, h5, h6',
    // For headings inside relative or absolute positioned containers within content.
    hasInnerContainers: true,
    orderedList: false,
    collapseDepth: 2,
  });
})</script><link rel="preload" href="https://cdn.bootcss.com/highlight.js/9.6.0/styles/github.min.css" as="style" onload="this.onload=null;this.rel='stylesheet'"><link rel="stylesheet" href="https://cdn.bootcss.com/highlight.js/9.6.0/styles/github.min.css"><link rel="preload" href="https://fonts.googleapis.com/css?family=Abril+Fatface&amp;display=swap" as="style" onload="this.onload=null;this.rel='stylesheet'"><link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Abril+Fatface&amp;display=swap"><meta name="generator" content="Hexo 5.2.0"></head><body><div class="mask-border"></div><div class="head"><div class="head__inner"><h1><a href="/">catherine's blog</a></h1><p></p></div></div><div class="paper-container"><div class="main"><div class="location-bar"><div class="line-1"><div class="horizontal-line" style="height: 3px"></div></div><div class="line-2"><div class="horizontal-line" style="height: 1px"></div></div><p class="text">Vuex的简单使用</p><div class="switch-button"><input class="container_toggle" type="checkbox" id="switch" name="mode"><label for="switch">Toggle</label></div><div class="line-3"><div class="horizontal-line" style="height: 1px"></div></div></div><div class="main__2-col"><article class="post-view__article"><div class="article__infomation"><div class="posts-item"><h2 class="posts-item__title"><a href="">Vuex的简单使用</a></h2><span class="post__date">2020-12-19</span><a href="/tags/%E5%89%8D%E7%AB%AF/"><span class="post__tags">#前端</span></a><a href="/tags/VueJs/"><span class="post__tags">#VueJs</span></a></div></div><div class="article__content"><p>Vuex的简单使用</p>
<h2 id="vuex中-this-store-dispatch-与-this-store-commit-方法的区别"><a href="#vuex中-this-store-dispatch-与-this-store-commit-方法的区别" class="headerlink" title="vuex中 this.$store.dispatch() 与 this.$store.commit()方法的区别"></a>vuex中 this.$store.dispatch() 与 this.$store.commit()方法的区别</h2><p>this.$store.dispatch()与this.$store.commit()方法的区别总的来说他们只是存取方式的不同,两个方法都是传值给vuex的mutation改变state</p>
<blockquote>
<p>This.$store.dispatch()：<br>含有异步操作，例如向后台提交数据<br>写法：<code>this.$store.dispatch(‘action方法名’,值)</code><br>this.$store.commit()：<br>同步操作<br>写法：<code>this.$store.commit(‘mutations方法名’,值) </code>  </p>
</blockquote>
<p>commit: 同步操作</p>
<ul>
<li>存储<br><code>this.$store.commit(‘changeValue’,name)</code></li>
<li>取值<br><code>this.$store.state.changeValue</code><br>Dispatch: 异步操作</li>
<li>存储<br><code>this.$store.dispatch(‘getlists’,name)</code></li>
<li>取值<br><code>this.$store.getters.getlists</code></li>
</ul>
<h2 id="如何在vue-element-admin中加载动态菜单"><a href="#如何在vue-element-admin中加载动态菜单" class="headerlink" title="如何在vue-element-admin中加载动态菜单"></a>如何在vue-element-admin中加载动态菜单</h2><p>首先router/index.js通过</p>
<figure class="highlight js"><table><tr><td class="code"><pre><code class="hljs js"><span class="hljs-keyword">const</span> createRouter = <span class="hljs-function">() =&gt;</span> <span class="hljs-keyword">new</span> Router(&#123;<br>  <span class="hljs-comment">// mode: &#x27;history&#x27;, // require service support</span><br>  scrollBehavior: <span class="hljs-function">() =&gt;</span> (&#123; <span class="hljs-attr">y</span>: <span class="hljs-number">0</span> &#125;),<br>  routes: constantRoutes<br>&#125;)<br></code></pre></td></tr></table></figure>
<p>加载constantRoutes，最初默认所有route都是在里面的<br>然后我们把权限路由放在<br>const asyncRoutes中，来根据登陆用户的roles判断应该返回那个菜单<br>官方文档给的还是蛮简单的，首先先在store/modules 新建一个permisson.js<br>完整版的官方demo里是包含这个的<br>可以将actions里的generateRoutes简单修改成自己的逻辑<br>然后在store/getter.js里加上permission.routes的state<br>最后修改src/permission.js<br>网上有一些解决方案是:</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><code class="hljs javascript"><span class="hljs-keyword">const</span> hasGetUserInfo = store.getters.name<br>    <span class="hljs-keyword">if</span> (hasGetUserInfo) &#123;<br>      next()<br>    &#125; <span class="hljs-keyword">else</span> &#123;<br>      <span class="hljs-keyword">try</span> &#123;<br>        <span class="hljs-comment">// get user info</span><br>        <span class="hljs-keyword">await</span> store.dispatch(<span class="hljs-string">&#x27;user/getInfo&#x27;</span>)<br>        <span class="hljs-comment">// accessRoutes generate</span><br>        <span class="hljs-keyword">const</span> accessRoutes = <span class="hljs-keyword">await</span> store.dispatch(<span class="hljs-string">&#x27;permission/generateRoutes&#x27;</span>)<br>        <span class="hljs-comment">// dynamically add accessible routes</span><br>        router.addRoutes(accessRoutes)<br>	 next()<br>      &#125; <span class="hljs-keyword">catch</span> (error) &#123;<br>        <span class="hljs-comment">// remove token and go to login page to re-login</span><br>        <span class="hljs-keyword">await</span> store.dispatch(<span class="hljs-string">&#x27;user/resetToken&#x27;</span>)<br>        Message.error(error || <span class="hljs-string">&#x27;Has Error&#x27;</span>)<br>        next(<span class="hljs-string">`/login?redirect=<span class="hljs-subst">$&#123;to.path&#125;</span>`</span>)<br>        NProgress.done()<br>      &#125;<br>    &#125;<br><br></code></pre></td></tr></table></figure>
<p>利用router.addRoutes就可以实现动态路由添加，但是侧边栏不会改变<br>所以在store.getter中维护的变量permission_routes还是派上了用场的<br>在后面加上<br><code>router.options.routes = store.getters.permission_routes</code></p>
<p>目前一切正常<br>接下来的任务就是通过后端来生成菜单，构建页面。下周再继续做。</p>
</div></article><div class="post-view__sidebar"><div class="sidebar"><div class="tocbot"><h2>Toc</h2><div class="toc__content"></div></div><h2>Links</h2><div class="sidebar__link"><ul><li><a target="_blank" rel="noopener" href="https://github.com/yours">Github</a></li><li><a target="_blank" rel="noopener" href="https://codepen.io/yours">Codepen</a></li><li><a target="_blank" rel="noopener" href="https://dribbble.com/yours">Dribbble</a></li><li><a target="_blank" rel="noopener" href="https://twitter.com/yours">Twitter</a></li><li><a target="_blank" rel="noopener" href="https://www.zhihu.com/people/yours">知乎</a></li><li><a target="_blank" rel="noopener" href="https://juejin.im/user/yours">掘金</a></li><li><a href="mailto:xxx@yourmail.xxxx">Mail</a></li></ul></div><h2>Archives</h2><div class="sidebar__archives"><ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2021/">2021</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/">2020</a></li></ul></div><h2>Categories</h2><div class="sidebar__categories"><ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="/categories/Django/">Django</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/Golang/">Golang</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E5%89%8D%E7%AB%AF/">前端</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E5%B7%A5%E5%85%B7-%E8%A7%84%E8%8C%83/">工具/规范</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E8%B7%A8%E5%B9%B3%E5%8F%B0/">跨平台</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E9%83%A8%E7%BD%B2/">部署</a></li></ul></div><h2>Tags</h2><div class="sidebar__tags"><ul class="tag-list" itemprop="keywords"><li class="tag-list-item"><a class="tag-list-link" href="/tags/Django/" rel="tag">Django</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Gin/" rel="tag">Gin</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/VueJs/" rel="tag">VueJs</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/docker/" rel="tag">docker</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/element-ui/" rel="tag">element-ui</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/go/" rel="tag">go</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/go%E5%9F%BA%E7%A1%80%E5%AD%A6%E4%B9%A0/" rel="tag">go基础学习</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/js/" rel="tag">js</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/nodeJS/" rel="tag">nodeJS</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/utils/" rel="tag">utils</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E5%89%8D%E7%AB%AF/" rel="tag">前端</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E5%90%8E%E7%AB%AF/" rel="tag">后端</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E8%B7%A8%E5%B9%B3%E5%8F%B0/" rel="tag">跨平台</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E9%83%A8%E7%BD%B2/" rel="tag">部署</a></li></ul></div></div></div></div><div class="horizontal-line" style="height: 1px"></div><div class="main__bottom"><div class="pre-next"><a class="pre-button" href="/2021/01/07/Element-ui%20%E4%BD%BF%E7%94%A8el-table%20%E5%B9%B6%E4%B8%94%E4%BD%BF%E6%9F%90%E4%B8%AA%E5%8D%95%E5%85%83%E6%A0%BCeditable/">Element-ui 使用el-table 并且使某个单元格editable</a><a class="next-button" href="/2020/11/21/electron-builder%20%E6%89%93%E5%8C%85%E5%AE%9E%E5%BD%95/">electron-builder 打包实录</a></div></div></div></div><div class="footer"><span>©️2019-2021 Designed By&nbsp;<strong><a target="_blank" rel="noopener" href="https://github.com/random-yang">RandomYang</a></strong> Powered By&nbsp;</span><strong><a target="_blank" rel="noopener" href="https://hexo.io">hexo</a></strong></div><div class="darkmode-mask" id="darkmode-mask"></div><div class="sidebar__button"></div></body></html>