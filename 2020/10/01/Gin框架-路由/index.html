<!DOCTYPE html><html lang="en"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=0"><meta name="description" content="Gin框架-路由 [ catherien's blog ] "><meta name="theme-color" content="#ebc65a"><title>Gin框架-路由 [ catherien's blog ] </title><link rel="shortcut icon" href="/favicon.ico"><link rel="stylesheet" href="/css/index.css"><script src="https://cdn.bootcss.com/highlight.js/9.6.0/highlight.min.js" defer></script><script src="/js/paper.js" defer></script><script src="https://www.googletagmanager.com/gtag/js?id=xx-xxxxxxx-xx" async></script><script>window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'xx-xxxxxxx-xx');</script><link rel="stylesheet" href="/css/tocbot.css"><script src="/js/tocbot.js" defer></script><script>window.addEventListener('DOMContentLoaded', () => {
  tocbot.init({
    // Where to render the table of contents.
    tocSelector: '.toc__content',
    // Where to grab the headings to build the table of contents.
    contentSelector: '.article__content',
    // Which headings to grab inside of the contentSelector element.
    headingSelector: 'h1, h2, h3, h4, h5, h6',
    // For headings inside relative or absolute positioned containers within content.
    hasInnerContainers: true,
    orderedList: false,
    collapseDepth: 2,
  });
})</script><link rel="preload" href="https://cdn.bootcss.com/highlight.js/9.6.0/styles/github.min.css" as="style" onload="this.onload=null;this.rel='stylesheet'"><link rel="stylesheet" href="https://cdn.bootcss.com/highlight.js/9.6.0/styles/github.min.css"><link rel="preload" href="https://fonts.googleapis.com/css?family=Abril+Fatface&amp;display=swap" as="style" onload="this.onload=null;this.rel='stylesheet'"><link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Abril+Fatface&amp;display=swap"><meta name="generator" content="Hexo 5.2.0"></head><body><div class="mask-border"></div><div class="head"><div class="head__inner"><h1><a href="/">catherien's blog</a></h1><p></p></div></div><div class="paper-container"><div class="main"><div class="location-bar"><div class="line-1"><div class="horizontal-line" style="height: 3px"></div></div><div class="line-2"><div class="horizontal-line" style="height: 1px"></div></div><p class="text">Gin框架-路由</p><div class="switch-button"><input class="container_toggle" type="checkbox" id="switch" name="mode"><label for="switch">Toggle</label></div><div class="line-3"><div class="horizontal-line" style="height: 1px"></div></div></div><div class="main__2-col"><article class="post-view__article"><div class="article__infomation"><div class="posts-item"><h2 class="posts-item__title"><a href="">Gin框架-路由</a></h2><span class="post__date">2020-10-01</span><a href="/tags/go/"><span class="post__tags">#go</span></a><a href="/tags/go%E5%9F%BA%E7%A1%80%E5%AD%A6%E4%B9%A0/"><span class="post__tags">#go基础学习</span></a><a href="/tags/Gin/"><span class="post__tags">#Gin</span></a></div></div><div class="article__content"><p>Gin框架-路由</p>
<h1 id="Gin路由"><a href="#Gin路由" class="headerlink" title="Gin路由"></a>Gin路由</h1><p>Gin 框架中采用的路由库是基于httprouter做的</p>
<h2 id="API-amp-amp-URL"><a href="#API-amp-amp-URL" class="headerlink" title="API&amp;&amp;URL"></a>API&amp;&amp;URL</h2><p>成功跑起一个hello-world，开始尝试请求服务器的API，gin采用RESTful命名方式</p>
<figure class="highlight go"><table><tr><td class="code"><pre><code class="hljs go"><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span> &#123;<br>	r := gin.Default()<br>	r.GET(<span class="hljs-string">&quot;/user/:name/*action&quot;</span>, <span class="hljs-function"><span class="hljs-keyword">func</span><span class="hljs-params">(c *gin.Context)</span></span> &#123;<br>		name := c.Param(<span class="hljs-string">&quot;name&quot;</span>)<br>		action := c.Param(<span class="hljs-string">&quot;action&quot;</span>)<br>		<span class="hljs-comment">//截取/</span><br>		action = strings.Trim(action, <span class="hljs-string">&quot;/&quot;</span>)<br>		c.String(http.StatusOK, name+<span class="hljs-string">&quot; is &quot;</span>+action)<br>	&#125;)<br>	<span class="hljs-comment">//默认为监听8080端口</span><br>	r.Run(<span class="hljs-string">&quot;:8000&quot;</span>)<br>&#125;<br><br><span class="hljs-comment">// 此时我们输入 localhost:端口/user/name/action/</span><br><span class="hljs-comment">// 服务器就会打印</span><br><span class="hljs-comment">// &#123;name&#125; is &#123;action&#125;</span><br></code></pre></td></tr></table></figure>
<p>我们也可以用URL传值，以GET的方式获取参数</p>
<figure class="highlight go"><table><tr><td class="code"><pre><code class="hljs go"><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span> &#123;<br>	r := gin.Default()<br>	r.GET(“/user”, <span class="hljs-function"><span class="hljs-keyword">func</span><span class="hljs-params">(c *gin.Context)</span></span> &#123;<br>		<span class="hljs-comment">//指定默认值</span><br>		<span class="hljs-comment">//http://localhost:8080/user 才会打印出来默认的值</span><br>		name := c.DefaultQuery(“name”, “枯藤”)<br>		c.String(http.*StatusOK*, fmt.Sprintf(“hello %s”, name))<br>	&#125;)<br>	r.Run()<br>&#125;<br><span class="hljs-comment">// 一般我们会设置缺省值</span><br></code></pre></td></tr></table></figure>

<h2 id="表单参数"><a href="#表单参数" class="headerlink" title="表单参数"></a>表单参数</h2><ul>
<li>表单传输为post请求，http常见的传输格式为四种：<ul>
<li>application/json</li>
<li>application/x-www-form-urlencoded</li>
<li>application/xml</li>
<li>multipart/form-data</li>
</ul>
</li>
<li>表单参数可以通过PostForm()方法获取，该方法默认解析的是x-www-form-urlencoded或from-data格式的参数<figure class="highlight go"><table><tr><td class="code"><pre><code class="hljs go"><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span> &#123;<br>	r := gin.Default()<br>	r.POST(“/form”, <span class="hljs-function"><span class="hljs-keyword">func</span><span class="hljs-params">(c *gin.Context)</span></span> &#123;<br>		types := c.DefaultPostForm(“<span class="hljs-keyword">type</span>”, “post”)<br>		username := c.PostForm(“username”)<br>		password := c.PostForm(“userpassword”)<br>		c.String(http.*StatusOK*, fmt.Sprintf(“username:%s,password:%s,<span class="hljs-keyword">type</span>:%s”, username, password, types))<br>	&#125;)<br>	r.Run()<br>&#125;<br></code></pre></td></tr></table></figure>

</li>
</ul>
<h2 id="上传多个文件的处理"><a href="#上传多个文件的处理" class="headerlink" title="上传多个文件的处理"></a>上传多个文件的处理</h2><p>因为文件和表单的处理是不一样的，在落地场景中，文件一般上传到云oss中</p>
<figure class="highlight go"><table><tr><td class="code"><pre><code class="hljs go"><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span> &#123;<br>   <span class="hljs-comment">// 1.创建路由</span><br>   <span class="hljs-comment">// 默认使用了2个中间件Logger(), Recovery()</span><br>   r := gin.Default()<br>   <span class="hljs-comment">// 限制表单上传大小 8MB，默认为32MB</span><br>   r.MaxMultipartMemory = <span class="hljs-number">8</span> &lt;&lt; <span class="hljs-number">20</span><br>   r.POST(“/upload”, <span class="hljs-function"><span class="hljs-keyword">func</span><span class="hljs-params">(c *gin.Context)</span></span> &#123;<br>      form, err := c.MultipartForm()<br>      <span class="hljs-keyword">if</span> err != <span class="hljs-literal">nil</span> &#123;<br>         c.String(http.StatusBadRequest, fmt.Sprintf(“get err %s”, err.Error()))<br>      &#125;<br>      <span class="hljs-comment">// 获取所有图片</span><br>      files := form.File[“files”]<br>      <span class="hljs-comment">// 遍历所有图片</span><br>      <span class="hljs-keyword">for</span> _, file := <span class="hljs-keyword">range</span> files &#123;<br>         <span class="hljs-comment">// 逐个存</span><br>         <span class="hljs-keyword">if</span> err := c.SaveUploadedFile(file, file.Filename); err != <span class="hljs-literal">nil</span> &#123;<br>            c.String(http.StatusBadRequest, fmt.Sprintf(“upload err %s”, err.Error()))<br>            <span class="hljs-keyword">return</span><br>         &#125;<br>      &#125;<br>      c.String(<span class="hljs-number">200</span>, fmt.Sprintf(“upload ok %d files”, <span class="hljs-built_in">len</span>(files)))<br>   &#125;)<br>   <span class="hljs-comment">//默认端口号是8080</span><br>   r.Run(“:<span class="hljs-number">8000</span>”)<br>&#125;<br></code></pre></td></tr></table></figure>
<h2 id="关于go-Routers的拆分"><a href="#关于go-Routers的拆分" class="headerlink" title="关于go Routers的拆分"></a>关于go Routers的拆分</h2><p>当项目比较大，每个app倾向于有自己的路由，再在routers中注册，结构会比较清晰容易管理。</p>
<figure class="highlight maxima"><table><tr><td class="code"><pre><code class="hljs maxima">gin_demo<br>├── app<br>│   ├── blog<br>│   │   ├── handler.<span class="hljs-built_in">go</span><br>│   │   └── router.<span class="hljs-built_in">go</span><br>│   └── shop<br>│       ├── handler.<span class="hljs-built_in">go</span><br>│       └── router.<span class="hljs-built_in">go</span><br>├── <span class="hljs-built_in">go</span>.<span class="hljs-built_in">mod</span><br>├── <span class="hljs-built_in">go</span>.<span class="hljs-built_in">sum</span><br>├── main.<span class="hljs-built_in">go</span><br>└── routers<br>    └── routers.<span class="hljs-built_in">go</span><br></code></pre></td></tr></table></figure>

<p>然后在routers.go中进行路由的初始化</p>
<figure class="highlight go"><table><tr><td class="code"><pre><code class="hljs go"><span class="hljs-keyword">type</span> Option <span class="hljs-function"><span class="hljs-keyword">func</span><span class="hljs-params">(*gin.Engine)</span></span><br><br><span class="hljs-keyword">var</span> options = []Option&#123;&#125;<br><br><span class="hljs-comment">// 注册app的路由配置</span><br><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">Include</span><span class="hljs-params">(opts …Option)</span></span> &#123;<br>    options = <span class="hljs-built_in">append</span>(options, opts…)<br>&#125;<br><br><span class="hljs-comment">// 初始化</span><br><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">Init</span><span class="hljs-params">()</span> *<span class="hljs-title">gin</span>.<span class="hljs-title">Engine</span></span> &#123;<br>    r := gin.New()<br>    <span class="hljs-keyword">for</span> _, opt := <span class="hljs-keyword">range</span> options &#123;<br>        opt(r)<br>    &#125;<br>    <span class="hljs-keyword">return</span> r<br>&#125;<br></code></pre></td></tr></table></figure>
<p>main.go中按如下方式先注册子app中的路由，然后再进行路由的初始化：</p>
<figure class="highlight go"><table><tr><td class="code"><pre><code class="hljs go"><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span> &#123;<br>    <span class="hljs-comment">// 加载多个APP的路由配置</span><br>    routers.Include(shop.Routers, blog.Routers)<br>    <span class="hljs-comment">// 初始化路由</span><br>    r := routers.Init()<br>    <span class="hljs-keyword">if</span> err := r.Run(); err != <span class="hljs-literal">nil</span> &#123;<br>        fmt.Println(“startup service failed, err:%v\n”, err)<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>





</div></article><div class="post-view__sidebar"><div class="sidebar"><div class="tocbot"><h2>Toc</h2><div class="toc__content"></div></div><h2>Links</h2><div class="sidebar__link"><ul><li><a target="_blank" rel="noopener" href="https://github.com/yours">Github</a></li><li><a target="_blank" rel="noopener" href="https://codepen.io/yours">Codepen</a></li><li><a target="_blank" rel="noopener" href="https://dribbble.com/yours">Dribbble</a></li><li><a target="_blank" rel="noopener" href="https://twitter.com/yours">Twitter</a></li><li><a target="_blank" rel="noopener" href="https://www.zhihu.com/people/yours">知乎</a></li><li><a target="_blank" rel="noopener" href="https://juejin.im/user/yours">掘金</a></li><li><a href="mailto:xxx@yourmail.xxxx">Mail</a></li></ul></div><h2>Archives</h2><div class="sidebar__archives"><ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/">2020</a></li></ul></div><h2>Categories</h2><div class="sidebar__categories"><ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="/categories/Django/">Django</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/Golang/">Golang</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E5%89%8D%E7%AB%AF/">前端</a></li></ul></div><h2>Tags</h2><div class="sidebar__tags"><ul class="tag-list" itemprop="keywords"><li class="tag-list-item"><a class="tag-list-link" href="/tags/Django/" rel="tag">Django</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Gin/" rel="tag">Gin</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/VueJs/" rel="tag">VueJs</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/go/" rel="tag">go</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/go%E5%9F%BA%E7%A1%80%E5%AD%A6%E4%B9%A0/" rel="tag">go基础学习</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E5%89%8D%E7%AB%AF/" rel="tag">前端</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E5%90%8E%E7%AB%AF/" rel="tag">后端</a></li></ul></div></div></div></div><div class="horizontal-line" style="height: 1px"></div><div class="main__bottom"><div class="pre-next"><a class="pre-button" href="/2020/10/10/Gin%E6%A1%86%E6%9E%B6-%E4%B8%AD%E9%97%B4%E4%BB%B6/">Gin框架-中间件</a><a class="next-button" href="/2020/09/25/Go%20%E8%A1%A8%E5%8D%95/">Go表单&amp;&amp;文件</a></div></div></div></div><div class="footer"><span>©️2019-2020 Designed By&nbsp;<strong><a target="_blank" rel="noopener" href="https://github.com/random-yang">RandomYang</a></strong> Powered By&nbsp;</span><strong><a target="_blank" rel="noopener" href="https://hexo.io">hexo</a></strong></div><div class="darkmode-mask" id="darkmode-mask"></div><div class="sidebar__button"></div></body></html>